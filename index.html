<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Venue Tracker ‚Äî Field Marketing</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∑</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F1EB; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #D5CEC4; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #B8A48E; }
    input[type="range"] { accent-color: #8B7355; }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    select, input, textarea, button { font-family: 'DM Sans', sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useMemo, useEffect, useCallback } = React;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONSTANTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const REGIONS = {
      "Northeast": ["New York", "Boston", "Philadelphia", "Washington DC", "Pittsburgh"],
      "Southeast": ["Atlanta", "Miami", "Charlotte", "Nashville", "Raleigh"],
      "Midwest": ["Chicago", "Detroit", "Minneapolis", "Columbus", "Indianapolis"],
      "Southwest": ["Dallas", "Houston", "Austin", "Phoenix", "Denver"],
      "West Coast": ["San Francisco", "Los Angeles", "Seattle", "Portland", "San Diego"],
    };
    const EVENT_SIZES = ["Intimate (8-20)", "Mid-size (20-50)", "Large (50-100+)"];
    const STATUSES = ["Prospect", "Contacted", "Visited", "Booked", "Used", "Archived"];
    const STATUS_COLORS = {
      Prospect: "#8B7355", Contacted: "#5B8A72", Visited: "#4A6FA5",
      Booked: "#7B68AE", Used: "#2D8659", Archived: "#888"
    };

    const STORAGE_KEY = "venue-tracker-data";
    const API_KEY_STORAGE = "venue-tracker-api-key";

    const loadVenues = () => {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) return JSON.parse(saved);
      } catch (e) {}
      return [
        { id: 1, name: "The Capital Grille", city: "New York", region: "Northeast", eventSizes: ["Intimate (8-20)", "Mid-size (20-50)"], pricePerHead: 185, privateRoom: true, av: false, dietary: true, exclusivity: 4, status: "Used", notes: "Excellent private dining room on 2nd floor. Sommelier very attentive. Used for Q3 CISO dinner ‚Äî great feedback.", contact: "Sarah M.", phone: "(212) 555-0134", lastUsed: "2025-09-15", rating: 5 },
        { id: 2, name: "RPM Italian", city: "Chicago", region: "Midwest", eventSizes: ["Intimate (8-20)", "Mid-size (20-50)"], pricePerHead: 165, privateRoom: true, av: false, dietary: true, exclusivity: 5, status: "Used", notes: "Hard to get the private room ‚Äî book 6+ weeks out. Celebrity chef kitchen. Clients love it.", contact: "Marco D.", phone: "(312) 555-0198", lastUsed: "2025-08-22", rating: 5 },
        { id: 3, name: "Nobu Dallas", city: "Dallas", region: "Southwest", eventSizes: ["Intimate (8-20)", "Mid-size (20-50)", "Large (50-100+)"], pricePerHead: 210, privateRoom: true, av: true, dietary: true, exclusivity: 5, status: "Booked", notes: "Booked for Feb exec dinner. Multiple private spaces available. AV in the larger room.", contact: "Jennifer L.", phone: "(214) 555-0267", lastUsed: "", rating: 0 },
        { id: 4, name: "The Sloane", city: "San Francisco", region: "West Coast", eventSizes: ["Mid-size (20-50)", "Large (50-100+)"], pricePerHead: 140, privateRoom: true, av: true, dietary: true, exclusivity: 3, status: "Visited", notes: "Modern event space with great AV setup. Rooftop option for cocktail hour. Good for product launch events.", contact: "David K.", phone: "(415) 555-0312", lastUsed: "", rating: 4 },
        { id: 5, name: "STK Atlanta", city: "Atlanta", region: "Southeast", eventSizes: ["Intimate (8-20)", "Mid-size (20-50)"], pricePerHead: 155, privateRoom: true, av: false, dietary: true, exclusivity: 4, status: "Prospect", notes: "Recommended by sales team. Upscale steakhouse, good energy. Need to do site visit.", contact: "", phone: "", lastUsed: "", rating: 0 },
        { id: 6, name: "Mbar at Mandarin Oriental", city: "Miami", region: "Southeast", eventSizes: ["Intimate (8-20)"], pricePerHead: 225, privateRoom: true, av: false, dietary: true, exclusivity: 5, status: "Contacted", notes: "Ultra-premium. Perfect for C-suite intimate dinners. Ocean views. Waiting on private dining availability for March.", contact: "Isabella R.", phone: "(305) 555-0445", lastUsed: "", rating: 0 },
        { id: 7, name: "The Warehouse District Venue", city: "Minneapolis", region: "Midwest", eventSizes: ["Mid-size (20-50)", "Large (50-100+)"], pricePerHead: 95, privateRoom: true, av: true, dietary: true, exclusivity: 2, status: "Used", notes: "Great value for larger field events. Industrial chic vibe. Full AV with projector and sound. Catering is flexible.", contact: "Tom H.", phone: "(612) 555-0178", lastUsed: "2025-07-10", rating: 4 },
        { id: 8, name: "Ocean Prime", city: "Denver", region: "Southwest", eventSizes: ["Intimate (8-20)", "Mid-size (20-50)"], pricePerHead: 170, privateRoom: true, av: false, dietary: true, exclusivity: 4, status: "Prospect", notes: "Corporate dining favorite in LoDo. Multiple private rooms. Need to reach out for pricing on 30-person events.", contact: "", phone: "", lastUsed: "", rating: 0 },
      ];
    };

    const guessRegion = (city) => {
      const cl = city.toLowerCase();
      for (const [region, cities] of Object.entries(REGIONS)) {
        if (cities.some(c => cl.includes(c.toLowerCase()) || c.toLowerCase().includes(cl))) return region;
      }
      return "";
    };

    const emptyVenue = () => ({
      id: Date.now(), name: "", city: "", region: "", eventSizes: [], pricePerHead: 0,
      privateRoom: false, av: false, dietary: false, exclusivity: 0, status: "Prospect",
      notes: "", contact: "", phone: "", lastUsed: "", rating: 0,
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REUSABLE COMPONENTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const StarRating = ({ rating, onRate, size = 16, interactive = false }) => (
      <div style={{ display: "flex", gap: 2 }}>
        {[1, 2, 3, 4, 5].map(star => (
          <span key={star} onClick={() => interactive && onRate && onRate(star)}
            style={{ cursor: interactive ? "pointer" : "default", fontSize: size, color: star <= rating ? "#C8956C" : "#D5CEC4", transition: "color 0.15s", userSelect: "none" }}>‚òÖ</span>
        ))}
      </div>
    );

    const Tag = ({ children, color = "#8B7355", filled = false }) => (
      <span style={{ display: "inline-block", padding: "2px 10px", borderRadius: 20, fontSize: 11, fontWeight: 500, letterSpacing: "0.02em",
        background: filled ? color : "transparent", color: filled ? "#fff" : color, border: `1.5px solid ${color}`, lineHeight: "20px", whiteSpace: "nowrap" }}>{children}</span>
    );

    const Toggle = ({ checked, onChange, label }) => (
      <label style={{ display: "flex", alignItems: "center", gap: 8, cursor: "pointer", fontSize: 13, color: "#5A5348" }}>
        <div onClick={() => onChange(!checked)} style={{ width: 36, height: 20, borderRadius: 10, background: checked ? "#8B7355" : "#D5CEC4", transition: "background 0.2s", position: "relative", cursor: "pointer" }}>
          <div style={{ width: 16, height: 16, borderRadius: 8, background: "#fff", position: "absolute", top: 2, left: checked ? 18 : 2, transition: "left 0.2s", boxShadow: "0 1px 3px rgba(0,0,0,0.15)" }} />
        </div>
        {label}
      </label>
    );

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STYLES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const selectStyle = { padding: "8px 12px", borderRadius: 8, border: "1.5px solid #D5CEC4", background: "#FDFCFA", fontSize: 13, fontFamily: "'DM Sans', sans-serif", color: "#3D3832", outline: "none", cursor: "pointer", minWidth: 130, boxSizing: "border-box" };
    const inputStyle = { ...selectStyle, cursor: "text", width: "100%" };
    const btnPrimary = { padding: "10px 24px", borderRadius: 8, border: "none", background: "#8B7355", color: "#fff", fontSize: 13, fontFamily: "'DM Sans', sans-serif", fontWeight: 600, cursor: "pointer", letterSpacing: "0.02em" };
    const btnSecondary = { ...btnPrimary, background: "transparent", color: "#8B7355", border: "1.5px solid #8B7355" };
    const labelStyle = { fontSize: 11, textTransform: "uppercase", letterSpacing: "0.08em", color: "#A09889", fontFamily: "'DM Sans', sans-serif", fontWeight: 600 };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function VenueTracker() {
      const [venues, setVenues] = useState(loadVenues);
      const [search, setSearch] = useState("");
      const [filterRegion, setFilterRegion] = useState("All");
      const [filterSize, setFilterSize] = useState("All");
      const [filterStatus, setFilterStatus] = useState("All");
      const [filterPrivate, setFilterPrivate] = useState(false);
      const [filterAV, setFilterAV] = useState(false);
      const [filterDietary, setFilterDietary] = useState(false);
      const [filterExclusivity, setFilterExclusivity] = useState(0);
      const [budgetMax, setBudgetMax] = useState(300);
      const [selectedVenue, setSelectedVenue] = useState(null);
      const [isEditing, setIsEditing] = useState(false);
      const [showAddForm, setShowAddForm] = useState(false);
      const [view, setView] = useState("grid");
      const [sortBy, setSortBy] = useState("name");
      const [mode, setMode] = useState("tracker");
      const [discoverCity, setDiscoverCity] = useState("");
      const [discoverType, setDiscoverType] = useState("upscale restaurants with private dining rooms");
      const [discoveredVenues, setDiscoveredVenues] = useState([]);
      const [isSearching, setIsSearching] = useState(false);
      const [searchError, setSearchError] = useState("");
      const [savedIds, setSavedIds] = useState(new Set());
      const [showSettings, setShowSettings] = useState(false);
      const [searchMode, setSearchMode] = useState("single");
      const [batchCities, setBatchCities] = useState("");
      const [batchProgress, setBatchProgress] = useState({ current: 0, total: 0, currentCity: "" });
      const [apiKey, setApiKey] = useState(() => {
        try { return localStorage.getItem(API_KEY_STORAGE) || ""; } catch(e) { return ""; }
      });

      // Auto-save venues to localStorage
      useEffect(() => {
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(venues)); } catch(e) {}
      }, [venues]);

      const filtered = useMemo(() => {
        let result = venues.filter(v => {
          if (search && !v.name.toLowerCase().includes(search.toLowerCase()) && !v.city.toLowerCase().includes(search.toLowerCase())) return false;
          if (filterRegion !== "All" && v.region !== filterRegion) return false;
          if (filterSize !== "All" && !v.eventSizes.includes(filterSize)) return false;
          if (filterStatus !== "All" && v.status !== filterStatus) return false;
          if (filterPrivate && !v.privateRoom) return false;
          if (filterAV && !v.av) return false;
          if (filterDietary && !v.dietary) return false;
          if (filterExclusivity > 0 && v.exclusivity < filterExclusivity) return false;
          if (v.pricePerHead > budgetMax && v.pricePerHead > 0) return false;
          return true;
        });
        result.sort((a, b) => {
          if (sortBy === "name") return a.name.localeCompare(b.name);
          if (sortBy === "price") return a.pricePerHead - b.pricePerHead;
          if (sortBy === "exclusivity") return b.exclusivity - a.exclusivity;
          if (sortBy === "rating") return b.rating - a.rating;
          if (sortBy === "city") return a.city.localeCompare(b.city);
          return 0;
        });
        return result;
      }, [venues, search, filterRegion, filterSize, filterStatus, filterPrivate, filterAV, filterDietary, filterExclusivity, budgetMax, sortBy]);

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Discovery ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const makeRequest = useCallback(async (messages, retries = 0) => {
        const response = await fetch("/.netlify/functions/api-proxy", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            apiKey: apiKey,
            model: "claude-sonnet-4-20250514",
            max_tokens: 8192,
            tools: [{ type: "web_search_20250305", name: "web_search" }],
            messages
          })
        });
        if (!response.ok) {
          const errText = await response.text();
          if (response.status === 401) throw new Error("Invalid API key. Please check your key in Settings.");
          throw new Error(`API error ${response.status}: ${errText.substring(0, 200)}`);
        }
        const data = await response.json();
        if (data.stop_reason === "tool_use") {
          const newMessages = [...messages, { role: "assistant", content: data.content }];
          const toolUseBlocks = data.content.filter(b => b.type === "tool_use");
          if (toolUseBlocks.length > 0) {
            const toolResults = toolUseBlocks.map(tu => ({
              type: "tool_result", tool_use_id: tu.id,
              content: "Search complete. Continue searching other sources or provide the final JSON array."
            }));
            newMessages.push({ role: "user", content: toolResults });
          }
          if (retries < 8) return makeRequest(newMessages, retries + 1);
          return data;
        }
        return data;
      }, [apiKey]);

      const searchOneCity = useCallback(async (city, venueType) => {
        const data = await makeRequest([{
          role: "user",
          content: `I need you to do multiple web searches to find ${venueType} in ${city}. Search ALL of these:

1. Search: "best private dining ${city} site:yelp.com"
2. Search: "best restaurants private rooms ${city} site:tripadvisor.com"
3. Search: "best corporate dinner restaurants ${city}"
4. Search: "private dining events ${city}"
5. Search: "upscale restaurants group dining ${city}"

Compile a DEDUPLICATED list of 15-20 real, currently operating restaurants suited for corporate dinners. Cross-reference across sources.

Return ONLY a raw JSON array. No markdown, no backticks, no explanation.

Each object: {"name":"Restaurant Name","cuisine":"Type","priceRange":"$$$$","estimatedPricePerHead":150,"privateRoom":true,"capacity":"10-40 guests","description":"1-2 sentences","neighborhood":"Area","knownFor":"Feature","sources":"Yelp, TripAdvisor, Google"}

IMPORTANT: 15-20 venues. ONLY the JSON array.`
        }]);

        const textBlocks = data.content.filter(item => item.type === "text").map(item => item.text).join("\n");
        if (!textBlocks.trim()) throw new Error(`No results for ${city}`);
        const cleaned = textBlocks.replace(/```json\s*/g, "").replace(/```\s*/g, "").trim();
        let parsed = null;
        try { parsed = JSON.parse(cleaned); } catch (e) {}
        if (!parsed) { const m = cleaned.match(/\[\s*\{[\s\S]*\}\s*\]/); if (m) { try { parsed = JSON.parse(m[0]); } catch(e) {} } }
        if (!parsed) { const s = cleaned.indexOf("["), e = cleaned.lastIndexOf("]"); if (s !== -1 && e > s) { try { parsed = JSON.parse(cleaned.substring(s, e + 1)); } catch(e) {} } }
        if (!parsed || !Array.isArray(parsed) || parsed.length === 0) throw new Error(`Could not parse results for ${city}`);

        return parsed.map((v, i) => ({
          name: v.name || "Unknown Venue", cuisine: v.cuisine || "", priceRange: v.priceRange || "$$$",
          estimatedPricePerHead: v.estimatedPricePerHead || 0, privateRoom: v.privateRoom !== false,
          capacity: v.capacity || "", description: v.description || "", neighborhood: v.neighborhood || "",
          knownFor: v.knownFor || "", sources: v.sources || "", city: city,
          _id: `disc-${Date.now()}-${city.replace(/\s/g,"")}-${i}`
        }));
      }, [makeRequest]);

      const discoverVenues = useCallback(async () => {
        if (!apiKey) { setShowSettings(true); return; }

        const cities = searchMode === "batch"
          ? batchCities.split(/[,\n]/).map(c => c.trim()).filter(c => c.length > 0)
          : [discoverCity.trim()];

        if (cities.length === 0 || (cities.length === 1 && !cities[0])) return;

        setIsSearching(true);
        setSearchError("");
        setDiscoveredVenues([]);
        setSavedIds(new Set());
        setBatchProgress({ current: 0, total: cities.length, currentCity: cities[0] });

        const allVenues = [];
        const errors = [];

        for (let i = 0; i < cities.length; i++) {
          const city = cities[i];
          setBatchProgress({ current: i, total: cities.length, currentCity: city });
          try {
            const venues = await searchOneCity(city, discoverType);
            allVenues.push(...venues);
            // Update results progressively so user sees them as they come in
            setDiscoveredVenues(prev => [...prev, ...venues]);
          } catch (err) {
            console.error(`Error searching ${city}:`, err);
            errors.push(city);
          }
        }

        setBatchProgress({ current: cities.length, total: cities.length, currentCity: "" });
        if (errors.length > 0 && allVenues.length === 0) {
          setSearchError(`Failed to search: ${errors.join(", ")}. Please try again.`);
        } else if (errors.length > 0) {
          setSearchError(`Completed with some errors. Could not search: ${errors.join(", ")}`);
        }
        setIsSearching(false);
      }, [discoverCity, discoverType, apiKey, searchMode, batchCities, searchOneCity]);

      const saveDiscoveredVenue = (dv) => {
        const city = dv.city || discoverCity.trim();
        const newVenue = {
          id: Date.now() + Math.random(), name: dv.name, city: city,
          region: guessRegion(city), eventSizes: [], pricePerHead: dv.estimatedPricePerHead || 0,
          privateRoom: dv.privateRoom || false, av: false, dietary: false,
          exclusivity: dv.priceRange === "$$$$$" ? 5 : dv.priceRange === "$$$$" ? 4 : 3,
          status: "Prospect",
          notes: `${dv.description || ""}\n\nNeighborhood: ${dv.neighborhood || "‚Äî"}\nKnown for: ${dv.knownFor || "‚Äî"}\nCuisine: ${dv.cuisine || "‚Äî"}\nCapacity: ${dv.capacity || "‚Äî"}${dv.sources ? `\nFound on: ${dv.sources}` : ""}`.trim(),
          contact: "", phone: "", lastUsed: "", rating: 0,
        };
        setVenues(prev => [...prev, newVenue]);
        setSavedIds(prev => new Set([...prev, dv._id]));
      };

      const saveVenue = (venue) => { setVenues(prev => prev.map(v => v.id === venue.id ? venue : v)); setSelectedVenue(venue); setIsEditing(false); };
      const addVenue = (venue) => { setVenues(prev => [...prev, venue]); setShowAddForm(false); setSelectedVenue(venue); };
      const deleteVenue = (id) => { setVenues(prev => prev.filter(v => v.id !== id)); setSelectedVenue(null); };

      const exportCSV = () => {
        const headers = ["Name","City","Region","Price/Head","Status","Private Room","AV","Dietary","Exclusivity","Rating","Contact","Phone","Notes"];
        const rows = venues.map(v => [v.name, v.city, v.region, v.pricePerHead, v.status, v.privateRoom?"Yes":"No", v.av?"Yes":"No", v.dietary?"Yes":"No", v.exclusivity, v.rating, v.contact, v.phone, `"${(v.notes||"").replace(/"/g,'""')}"`]);
        const csv = [headers.join(","), ...rows.map(r => r.join(","))].join("\n");
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a"); a.href = url; a.download = "venue-tracker-export.csv"; a.click();
        URL.revokeObjectURL(url);
      };

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Settings Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const SettingsModal = () => {
        const [tempKey, setTempKey] = useState(apiKey);
        const [testResult, setTestResult] = useState("");
        const [testing, setTesting] = useState(false);

        const testKey = async () => {
          if (!tempKey.trim()) { setTestResult("‚ùå No key entered"); return; }
          setTesting(true);
          setTestResult("Testing...");
          try {
            const response = await fetch("/.netlify/functions/api-proxy", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                apiKey: tempKey.trim(),
                model: "claude-sonnet-4-20250514",
                max_tokens: 50,
                messages: [{ role: "user", content: "Say hello in 3 words" }]
              })
            });
            if (response.ok) {
              setTestResult("‚úÖ Key is valid and working!");
            } else {
              const errData = await response.text();
              setTestResult(`‚ùå Error ${response.status}: ${errData.substring(0, 300)}`);
            }
          } catch (err) {
            setTestResult(`‚ùå Network error: ${err.message}`);
          } finally {
            setTesting(false);
          }
        };

        return (
          <div style={{ position: "fixed", inset: 0, background: "rgba(44,38,34,0.45)", zIndex: 300, display: "flex", alignItems: "center", justifyContent: "center", backdropFilter: "blur(4px)" }}
            onClick={e => { if (e.target === e.currentTarget) setShowSettings(false); }}>
            <div style={{ background: "#FDFCFA", borderRadius: 16, width: 520, padding: 36, boxShadow: "0 20px 60px rgba(0,0,0,0.15)" }}>
              <h2 style={{ margin: "0 0 8px", fontFamily: "'Playfair Display', serif", color: "#2C2622", fontSize: 22 }}>Settings</h2>
              <p style={{ margin: "0 0 24px", fontSize: 14, color: "#8B8279", lineHeight: 1.5 }}>
                The Discover feature uses the Anthropic API to search for venues. You'll need an API key from <a href="https://console.anthropic.com/" target="_blank" style={{ color: "#8B7355" }}>console.anthropic.com</a>.
              </p>
              <label style={{ ...labelStyle, marginBottom: 6, display: "block" }}>Anthropic API Key</label>
              <input type="password" value={tempKey} onChange={e => setTempKey(e.target.value)} placeholder="sk-ant-..." style={{ ...inputStyle, fontSize: 14, padding: "12px 16px", marginBottom: 4 }} />
              <p style={{ fontSize: 11, color: "#A09889", margin: "0 0 4px", fontFamily: "monospace", wordBreak: "break-all" }}>
                {tempKey ? `Key starts with: ${tempKey.substring(0, 12)}...` : "No key entered"}
              </p>
              <p style={{ fontSize: 12, color: "#A09889", margin: "0 0 16px" }}>Your key is stored locally in this browser only.</p>
              {testResult && (
                <div style={{ padding: 12, borderRadius: 8, marginBottom: 16, fontSize: 13, lineHeight: 1.5, wordBreak: "break-word",
                  background: testResult.startsWith("‚úÖ") ? "#F0F9F4" : testResult.startsWith("‚ùå") ? "#FFF5F5" : "#FFF9EE",
                  color: testResult.startsWith("‚úÖ") ? "#2D6A4F" : testResult.startsWith("‚ùå") ? "#8B4444" : "#8B7355",
                  border: `1px solid ${testResult.startsWith("‚úÖ") ? "#B7E4C7" : testResult.startsWith("‚ùå") ? "#E8C4C4" : "#E8D9B8"}`
                }}>{testResult}</div>
              )}
              <div style={{ display: "flex", gap: 12, flexWrap: "wrap" }}>
                <button onClick={() => {
                  const trimmed = tempKey.trim();
                  setApiKey(trimmed);
                  try { localStorage.setItem(API_KEY_STORAGE, trimmed); } catch(e) {}
                  setShowSettings(false);
                }} style={btnPrimary}>Save Key</button>
                <button onClick={testKey} disabled={testing} style={{ ...btnSecondary, opacity: testing ? 0.6 : 1 }}>{testing ? "Testing..." : "Test Key"}</button>
                <button onClick={() => setShowSettings(false)} style={btnSecondary}>Cancel</button>
                {apiKey && <button onClick={() => {
                  setApiKey(""); setTempKey("");
                  try { localStorage.removeItem(API_KEY_STORAGE); } catch(e) {}
                }} style={{ ...btnSecondary, color: "#C0392B", borderColor: "#C0392B", marginLeft: "auto" }}>Remove Key</button>}
              </div>
            </div>
          </div>
        );
      };

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Detail Panel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const DetailPanel = ({ venue }) => {
        const [ed, setEd] = useState({ ...venue });
        const editing = isEditing;
        useEffect(() => { setEd({ ...venue }); }, [venue]);
        return (
          <div style={{ position: "fixed", top: 0, right: 0, width: 520, height: "100vh", background: "#FDFCFA", borderLeft: "1px solid #E8E2D9", zIndex: 100, overflowY: "auto", boxShadow: "-8px 0 40px rgba(0,0,0,0.08)", animation: "slideIn 0.25s ease" }}>
            <div style={{ padding: "28px 32px", borderBottom: "1px solid #E8E2D9", display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
              <div style={{ flex: 1 }}>
                {editing ? <input value={ed.name} onChange={e => setEd({ ...ed, name: e.target.value })} style={{ ...inputStyle, fontSize: 20, fontWeight: 600, fontFamily: "'Playfair Display', serif" }} />
                  : <h2 style={{ margin: 0, fontSize: 22, fontFamily: "'Playfair Display', serif", color: "#2C2622", fontWeight: 600 }}>{venue.name}</h2>}
                {editing ? (
                  <div style={{ display: "flex", gap: 8, marginTop: 8 }}>
                    <input value={ed.city} onChange={e => setEd({ ...ed, city: e.target.value })} placeholder="City" style={{ ...inputStyle, width: 140 }} />
                    <select value={ed.region} onChange={e => setEd({ ...ed, region: e.target.value })} style={selectStyle}>
                      <option value="">Region</option>
                      {Object.keys(REGIONS).map(r => <option key={r}>{r}</option>)}
                    </select>
                  </div>
                ) : <p style={{ margin: "4px 0 0", fontSize: 14, color: "#8B8279" }}>{venue.city}{venue.region ? ` ¬∑ ${venue.region}` : ""}</p>}
              </div>
              <button onClick={() => { setSelectedVenue(null); setIsEditing(false); }} style={{ background: "none", border: "none", fontSize: 22, cursor: "pointer", color: "#A09889", padding: 4, lineHeight: 1 }}>‚úï</button>
            </div>
            <div style={{ padding: "24px 32px" }}>
              <div style={{ display: "flex", gap: 12, marginBottom: 24, flexWrap: "wrap", alignItems: "center" }}>
                {editing ? <select value={ed.status} onChange={e => setEd({ ...ed, status: e.target.value })} style={selectStyle}>{STATUSES.map(s => <option key={s}>{s}</option>)}</select>
                  : <Tag filled color={STATUS_COLORS[venue.status]}>{venue.status}</Tag>}
                {venue.privateRoom && <Tag color="#5B8A72">Private Room</Tag>}
                {venue.av && <Tag color="#4A6FA5">AV Ready</Tag>}
                {venue.dietary && <Tag color="#7B68AE">Dietary Flex</Tag>}
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20, marginBottom: 28 }}>
                <div>
                  <label style={labelStyle}>Price / Head</label>
                  {editing ? <input type="number" value={ed.pricePerHead} onChange={e => setEd({ ...ed, pricePerHead: +e.target.value })} style={{ ...inputStyle, marginTop: 4 }} />
                    : <p style={{ margin: "4px 0 0", fontSize: 24, fontWeight: 600, color: "#2C2622", fontFamily: "'Playfair Display', serif" }}>${venue.pricePerHead}</p>}
                </div>
                <div>
                  <label style={labelStyle}>Exclusivity</label>
                  <div style={{ marginTop: 6 }}><StarRating rating={editing ? ed.exclusivity : venue.exclusivity} interactive={editing} onRate={r => setEd({ ...ed, exclusivity: r })} size={20} /></div>
                </div>
                <div>
                  <label style={labelStyle}>Your Rating</label>
                  <div style={{ marginTop: 6 }}><StarRating rating={editing ? ed.rating : venue.rating} interactive={editing} onRate={r => setEd({ ...ed, rating: r })} size={20} /></div>
                </div>
                <div>
                  <label style={labelStyle}>Last Used</label>
                  {editing ? <input type="date" value={ed.lastUsed} onChange={e => setEd({ ...ed, lastUsed: e.target.value })} style={{ ...inputStyle, marginTop: 4 }} />
                    : <p style={{ margin: "4px 0 0", fontSize: 15, color: "#3D3832" }}>{venue.lastUsed || "‚Äî"}</p>}
                </div>
              </div>
              <div style={{ marginBottom: 24 }}>
                <label style={labelStyle}>Event Sizes</label>
                {editing ? (
                  <div style={{ display: "flex", gap: 8, marginTop: 8, flexWrap: "wrap" }}>
                    {EVENT_SIZES.map(size => (
                      <label key={size} style={{ display: "flex", alignItems: "center", gap: 6, fontSize: 13, cursor: "pointer", color: "#5A5348" }}>
                        <input type="checkbox" checked={ed.eventSizes.includes(size)} onChange={e => setEd({ ...ed, eventSizes: e.target.checked ? [...ed.eventSizes, size] : ed.eventSizes.filter(s => s !== size) })} /> {size}
                      </label>
                    ))}
                  </div>
                ) : (
                  <div style={{ display: "flex", gap: 6, marginTop: 6, flexWrap: "wrap" }}>
                    {venue.eventSizes.length ? venue.eventSizes.map(s => <Tag key={s} color="#8B7355">{s}</Tag>) : <span style={{ fontSize: 13, color: "#A09889" }}>‚Äî</span>}
                  </div>
                )}
              </div>
              {editing && (
                <div style={{ display: "flex", gap: 16, marginBottom: 24 }}>
                  <Toggle checked={ed.privateRoom} onChange={v => setEd({ ...ed, privateRoom: v })} label="Private Room" />
                  <Toggle checked={ed.av} onChange={v => setEd({ ...ed, av: v })} label="AV Ready" />
                  <Toggle checked={ed.dietary} onChange={v => setEd({ ...ed, dietary: v })} label="Dietary Flex" />
                </div>
              )}
              <div style={{ marginBottom: 24 }}>
                <label style={labelStyle}>Contact</label>
                {editing ? (
                  <div style={{ display: "flex", gap: 8, marginTop: 6 }}>
                    <input value={ed.contact} onChange={e => setEd({ ...ed, contact: e.target.value })} placeholder="Name" style={{ ...inputStyle, width: "50%" }} />
                    <input value={ed.phone} onChange={e => setEd({ ...ed, phone: e.target.value })} placeholder="Phone" style={{ ...inputStyle, width: "50%" }} />
                  </div>
                ) : <p style={{ margin: "4px 0 0", fontSize: 14, color: "#3D3832" }}>{venue.contact ? `${venue.contact}${venue.phone ? ` ¬∑ ${venue.phone}` : ""}` : "‚Äî"}</p>}
              </div>
              <div style={{ marginBottom: 28 }}>
                <label style={labelStyle}>Notes</label>
                {editing ? <textarea value={ed.notes} onChange={e => setEd({ ...ed, notes: e.target.value })} rows={4} style={{ ...inputStyle, marginTop: 6, resize: "vertical" }} />
                  : <p style={{ margin: "6px 0 0", fontSize: 14, color: "#5A5348", lineHeight: 1.6, whiteSpace: "pre-line" }}>{venue.notes || "‚Äî"}</p>}
              </div>
              <div style={{ display: "flex", gap: 12 }}>
                {editing ? (
                  <React.Fragment>
                    <button onClick={() => saveVenue(ed)} style={btnPrimary}>Save Changes</button>
                    <button onClick={() => setIsEditing(false)} style={btnSecondary}>Cancel</button>
                  </React.Fragment>
                ) : (
                  <React.Fragment>
                    <button onClick={() => setIsEditing(true)} style={btnPrimary}>Edit Venue</button>
                    <button onClick={() => { if (confirm("Delete this venue?")) deleteVenue(venue.id); }} style={{ ...btnSecondary, color: "#C0392B", borderColor: "#C0392B" }}>Delete</button>
                  </React.Fragment>
                )}
              </div>
            </div>
          </div>
        );
      };

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Add Form ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const AddForm = () => {
        const [nv, setNv] = useState(emptyVenue());
        return (
          <div style={{ position: "fixed", inset: 0, background: "rgba(44,38,34,0.45)", zIndex: 200, display: "flex", alignItems: "center", justifyContent: "center", backdropFilter: "blur(4px)" }} onClick={e => { if (e.target === e.currentTarget) setShowAddForm(false); }}>
            <div style={{ background: "#FDFCFA", borderRadius: 16, width: 560, maxHeight: "85vh", overflowY: "auto", padding: 36, boxShadow: "0 20px 60px rgba(0,0,0,0.15)" }}>
              <h2 style={{ margin: "0 0 24px", fontFamily: "'Playfair Display', serif", color: "#2C2622", fontSize: 24 }}>Add New Venue</h2>
              <div style={{ display: "grid", gap: 16 }}>
                <input value={nv.name} onChange={e => setNv({ ...nv, name: e.target.value })} placeholder="Venue name" style={{ ...inputStyle, fontSize: 16 }} />
                <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
                  <input value={nv.city} onChange={e => setNv({ ...nv, city: e.target.value })} placeholder="City" style={inputStyle} />
                  <select value={nv.region} onChange={e => setNv({ ...nv, region: e.target.value })} style={selectStyle}>
                    <option value="">Select Region</option>
                    {Object.keys(REGIONS).map(r => <option key={r}>{r}</option>)}
                  </select>
                </div>
                <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
                  <div><label style={{ ...labelStyle, marginBottom: 4, display: "block" }}>Price / Head ($)</label><input type="number" value={nv.pricePerHead || ""} onChange={e => setNv({ ...nv, pricePerHead: +e.target.value })} style={inputStyle} /></div>
                  <div><label style={{ ...labelStyle, marginBottom: 4, display: "block" }}>Status</label><select value={nv.status} onChange={e => setNv({ ...nv, status: e.target.value })} style={selectStyle}>{STATUSES.map(s => <option key={s}>{s}</option>)}</select></div>
                </div>
                <div>
                  <label style={{ ...labelStyle, marginBottom: 8, display: "block" }}>Event Sizes</label>
                  <div style={{ display: "flex", gap: 12, flexWrap: "wrap" }}>
                    {EVENT_SIZES.map(size => (
                      <label key={size} style={{ display: "flex", alignItems: "center", gap: 6, fontSize: 13, cursor: "pointer", color: "#5A5348" }}>
                        <input type="checkbox" checked={nv.eventSizes.includes(size)} onChange={e => setNv({ ...nv, eventSizes: e.target.checked ? [...nv.eventSizes, size] : nv.eventSizes.filter(s => s !== size) })} /> {size}
                      </label>
                    ))}
                  </div>
                </div>
                <div style={{ display: "flex", gap: 20 }}>
                  <Toggle checked={nv.privateRoom} onChange={v => setNv({ ...nv, privateRoom: v })} label="Private Room" />
                  <Toggle checked={nv.av} onChange={v => setNv({ ...nv, av: v })} label="AV Ready" />
                  <Toggle checked={nv.dietary} onChange={v => setNv({ ...nv, dietary: v })} label="Dietary Flex" />
                </div>
                <div><label style={{ ...labelStyle, marginBottom: 4, display: "block" }}>Exclusivity</label><StarRating rating={nv.exclusivity} interactive onRate={r => setNv({ ...nv, exclusivity: r })} size={22} /></div>
                <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
                  <input value={nv.contact} onChange={e => setNv({ ...nv, contact: e.target.value })} placeholder="Contact name" style={inputStyle} />
                  <input value={nv.phone} onChange={e => setNv({ ...nv, phone: e.target.value })} placeholder="Phone" style={inputStyle} />
                </div>
                <textarea value={nv.notes} onChange={e => setNv({ ...nv, notes: e.target.value })} placeholder="Notes ‚Äî booking tips, room details, what worked well..." rows={3} style={{ ...inputStyle, resize: "vertical" }} />
                <div style={{ display: "flex", gap: 12, marginTop: 8 }}>
                  <button onClick={() => { if (nv.name && nv.city) addVenue(nv); }} style={{ ...btnPrimary, opacity: nv.name && nv.city ? 1 : 0.5 }}>Add Venue</button>
                  <button onClick={() => setShowAddForm(false)} style={btnSecondary}>Cancel</button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Cards ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const DiscoveredCard = ({ dv }) => {
        const isSaved = savedIds.has(dv._id);
        const alreadyIn = venues.some(v => v.name.toLowerCase() === dv.name.toLowerCase());
        return (
          <div style={{ background: "#fff", borderRadius: 12, padding: 24, border: "1.5px solid #E8E2D9", transition: "all 0.2s", display: "flex", flexDirection: "column", animation: "fadeIn 0.3s ease" }}
            onMouseEnter={e => { e.currentTarget.style.borderColor = "#C8B89A"; e.currentTarget.style.boxShadow = "0 6px 24px rgba(139,115,85,0.12)"; }}
            onMouseLeave={e => { e.currentTarget.style.borderColor = "#E8E2D9"; e.currentTarget.style.boxShadow = "none"; }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 8 }}>
              <div style={{ flex: 1 }}>
                <h3 style={{ margin: 0, fontSize: 17, fontFamily: "'Playfair Display', serif", color: "#2C2622", fontWeight: 600 }}>{dv.name}</h3>
                <p style={{ margin: "3px 0 0", fontSize: 13, color: "#8B8279" }}>{dv.neighborhood}{dv.neighborhood && dv.cuisine ? " ¬∑ " : ""}{dv.cuisine}</p>
              </div>
              <span style={{ fontSize: 14, fontWeight: 600, color: "#8B7355", whiteSpace: "nowrap" }}>{dv.priceRange}</span>
            </div>
            <p style={{ fontSize: 13, color: "#5A5348", lineHeight: 1.55, margin: "10px 0 14px", flex: 1 }}>{dv.description}</p>
            <div style={{ display: "flex", gap: 6, flexWrap: "wrap", marginBottom: 14 }}>
              {dv.privateRoom && <Tag color="#5B8A72">Private Dining</Tag>}
              {dv.capacity && <Tag color="#4A6FA5">{dv.capacity}</Tag>}
              {dv.estimatedPricePerHead > 0 && <Tag color="#8B7355">~${dv.estimatedPricePerHead}/head</Tag>}
            </div>
            {dv.knownFor && <p style={{ fontSize: 12, color: "#A09889", fontStyle: "italic", margin: "0 0 6px" }}>Known for: {dv.knownFor}</p>}
            {dv.sources && <p style={{ fontSize: 11, color: "#4A6FA5", margin: "0 0 14px", fontWeight: 500 }}>üìç {dv.sources}</p>}
            <button onClick={() => !isSaved && !alreadyIn && saveDiscoveredVenue(dv)} disabled={isSaved || alreadyIn}
              style={{ ...btnPrimary, width: "100%", textAlign: "center", background: isSaved || alreadyIn ? "#D5CEC4" : "#8B7355", cursor: isSaved || alreadyIn ? "default" : "pointer" }}>
              {alreadyIn ? "Already in Tracker" : isSaved ? "‚úì Saved to Tracker" : "Ôºã Save to Tracker"}
            </button>
          </div>
        );
      };

      const VenueCard = ({ venue }) => (
        <div onClick={() => { setSelectedVenue(venue); setIsEditing(false); }}
          style={{ background: "#fff", borderRadius: 12, padding: 22, border: "1.5px solid #E8E2D9", cursor: "pointer", transition: "all 0.2s",
            boxShadow: selectedVenue?.id === venue.id ? "0 4px 20px rgba(139,115,85,0.15)" : "0 1px 4px rgba(0,0,0,0.04)" }}
          onMouseEnter={e => { e.currentTarget.style.borderColor = "#C8B89A"; e.currentTarget.style.transform = "translateY(-2px)"; e.currentTarget.style.boxShadow = "0 6px 24px rgba(139,115,85,0.12)"; }}
          onMouseLeave={e => { e.currentTarget.style.borderColor = "#E8E2D9"; e.currentTarget.style.transform = "none"; e.currentTarget.style.boxShadow = "0 1px 4px rgba(0,0,0,0.04)"; }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 10 }}>
            <div>
              <h3 style={{ margin: 0, fontSize: 16, fontFamily: "'Playfair Display', serif", color: "#2C2622", fontWeight: 600 }}>{venue.name}</h3>
              <p style={{ margin: "3px 0 0", fontSize: 13, color: "#8B8279" }}>{venue.city}{venue.region ? ` ¬∑ ${venue.region}` : ""}</p>
            </div>
            <Tag filled color={STATUS_COLORS[venue.status]}>{venue.status}</Tag>
          </div>
          <div style={{ display: "flex", alignItems: "center", gap: 16, marginBottom: 12 }}>
            <span style={{ fontSize: 20, fontWeight: 600, color: "#2C2622", fontFamily: "'Playfair Display', serif" }}>${venue.pricePerHead}</span>
            <span style={{ fontSize: 12, color: "#A09889" }}>/ head</span>
            <div style={{ marginLeft: "auto" }}><StarRating rating={venue.exclusivity} size={14} /></div>
          </div>
          <div style={{ display: "flex", gap: 6, flexWrap: "wrap" }}>
            {venue.privateRoom && <Tag color="#5B8A72">Private</Tag>}
            {venue.av && <Tag color="#4A6FA5">AV</Tag>}
            {venue.dietary && <Tag color="#7B68AE">Dietary</Tag>}
            {venue.eventSizes.map(s => <Tag key={s} color="#B8A48E">{s.split(" ")[0]}</Tag>)}
          </div>
          {venue.rating > 0 && (
            <div style={{ marginTop: 10, paddingTop: 10, borderTop: "1px solid #F0ECE6", display: "flex", alignItems: "center", gap: 6 }}>
              <span style={{ fontSize: 11, color: "#A09889", textTransform: "uppercase", letterSpacing: "0.06em" }}>Your Rating</span>
              <StarRating rating={venue.rating} size={12} />
            </div>
          )}
        </div>
      );

      const VenueRow = ({ venue }) => (
        <tr onClick={() => { setSelectedVenue(venue); setIsEditing(false); }} style={{ cursor: "pointer", transition: "background 0.15s" }}
          onMouseEnter={e => e.currentTarget.style.background = "#F8F5F0"} onMouseLeave={e => e.currentTarget.style.background = "transparent"}>
          <td style={{ padding: "14px 16px", fontFamily: "'Playfair Display', serif", fontWeight: 600, fontSize: 14, color: "#2C2622" }}>{venue.name}</td>
          <td style={{ padding: "14px 12px", fontSize: 13, color: "#5A5348" }}>{venue.city}</td>
          <td style={{ padding: "14px 12px", fontSize: 13, color: "#8B8279" }}>{venue.region}</td>
          <td style={{ padding: "14px 12px", fontSize: 14, fontWeight: 600, color: "#2C2622" }}>${venue.pricePerHead}</td>
          <td style={{ padding: "14px 12px" }}><StarRating rating={venue.exclusivity} size={13} /></td>
          <td style={{ padding: "14px 12px" }}><Tag filled color={STATUS_COLORS[venue.status]}>{venue.status}</Tag></td>
          <td style={{ padding: "14px 12px" }}><div style={{ display: "flex", gap: 4 }}>{venue.privateRoom && <Tag color="#5B8A72">P</Tag>}{venue.av && <Tag color="#4A6FA5">AV</Tag>}{venue.dietary && <Tag color="#7B68AE">D</Tag>}</div></td>
          <td style={{ padding: "14px 12px" }}><StarRating rating={venue.rating} size={13} /></td>
        </tr>
      );

      const stats = useMemo(() => ({
        total: venues.length, used: venues.filter(v => v.status === "Used").length,
        booked: venues.filter(v => v.status === "Booked").length, regions: new Set(venues.filter(v => v.region).map(v => v.region)).size,
        avgPrice: venues.length ? Math.round(venues.reduce((a, v) => a + v.pricePerHead, 0) / venues.length) : 0,
      }), [venues]);

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RENDER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      return (
        <div style={{ minHeight: "100vh", background: "#F5F1EB" }}>
          {/* Header */}
          <div style={{ background: "#2C2622", padding: "28px 40px 0", color: "#F5F1EB" }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-end", marginBottom: 20 }}>
              <div>
                <p style={{ margin: "0 0 4px", fontSize: 11, textTransform: "uppercase", letterSpacing: "0.15em", color: "#C8B89A", fontWeight: 600 }}>Field Marketing</p>
                <h1 style={{ margin: 0, fontSize: 32, fontFamily: "'Playfair Display', serif", fontWeight: 600 }}>Venue Tracker</h1>
              </div>
              <div style={{ display: "flex", gap: 32, alignItems: "flex-end", marginBottom: 4 }}>
                {[{ label: "Total", val: stats.total }, { label: "Avg $/Head", val: `$${stats.avgPrice}` }, { label: "Regions", val: stats.regions }, { label: "Used", val: stats.used }, { label: "Booked", val: stats.booked }].map(s => (
                  <div key={s.label} style={{ textAlign: "center" }}>
                    <p style={{ margin: 0, fontSize: 22, fontWeight: 600, fontFamily: "'Playfair Display', serif", color: "#C8956C" }}>{s.val}</p>
                    <p style={{ margin: "2px 0 0", fontSize: 10, textTransform: "uppercase", letterSpacing: "0.1em", color: "#A09889" }}>{s.label}</p>
                  </div>
                ))}
                <button onClick={() => setShowSettings(true)} style={{ background: "none", border: "1px solid #5A5348", borderRadius: 8, color: "#A09889", padding: "8px 16px", fontSize: 12, cursor: "pointer", fontWeight: 600, marginLeft: 8 }}>‚öô Settings</button>
                <button onClick={exportCSV} style={{ background: "none", border: "1px solid #5A5348", borderRadius: 8, color: "#A09889", padding: "8px 16px", fontSize: 12, cursor: "pointer", fontWeight: 600 }}>‚Üì Export CSV</button>
              </div>
            </div>
            <div style={{ display: "flex", gap: 0 }}>
              {[{ key: "tracker", label: "My Venues", icon: "‚óª" }, { key: "discover", label: "Discover Venues", icon: "‚åï" }].map(tab => (
                <button key={tab.key} onClick={() => { setMode(tab.key); setSelectedVenue(null); }}
                  style={{ padding: "12px 28px", border: "none", borderRadius: "10px 10px 0 0", fontSize: 14, fontWeight: 600, cursor: "pointer", letterSpacing: "0.02em", transition: "all 0.2s",
                    background: mode === tab.key ? "#F5F1EB" : "transparent", color: mode === tab.key ? "#2C2622" : "#A09889" }}>
                  {tab.icon} {tab.label}
                </button>
              ))}
            </div>
          </div>

          {/* ‚ïê‚ïê‚ïê DISCOVER ‚ïê‚ïê‚ïê */}
          {mode === "discover" && (
            <div style={{ padding: "0 40px 40px" }}>
              <div style={{ background: "#FDFCFA", borderRadius: "0 12px 12px 12px", padding: "32px 36px", border: "1px solid #E8E2D9", marginBottom: 24 }}>
                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 6 }}>
                  <h2 style={{ margin: 0, fontSize: 20, fontFamily: "'Playfair Display', serif", color: "#2C2622" }}>Find Venues in Any City</h2>
                  <div style={{ display: "flex", border: "1.5px solid #D5CEC4", borderRadius: 8, overflow: "hidden" }}>
                    <button onClick={() => setSearchMode("single")}
                      style={{ padding: "6px 16px", border: "none", background: searchMode === "single" ? "#8B7355" : "#FDFCFA", color: searchMode === "single" ? "#fff" : "#8B8279", fontSize: 12, cursor: "pointer", fontWeight: 600 }}>
                      Single City
                    </button>
                    <button onClick={() => setSearchMode("batch")}
                      style={{ padding: "6px 16px", border: "none", background: searchMode === "batch" ? "#8B7355" : "#FDFCFA", color: searchMode === "batch" ? "#fff" : "#8B8279", fontSize: 12, cursor: "pointer", fontWeight: 600 }}>
                      Batch Search
                    </button>
                  </div>
                </div>
                <p style={{ margin: "0 0 20px", fontSize: 14, color: "#8B8279" }}>
                  {searchMode === "single"
                    ? "Searches Yelp, TripAdvisor, and Google to find 15-20 venues per city."
                    : "Search up to 15 cities at once ‚Äî results appear as each city completes."}
                  {!apiKey && <span style={{ color: "#C0392B" }}> Set up your API key in Settings to enable search.</span>}
                </p>

                {searchMode === "single" ? (
                  <div style={{ display: "flex", gap: 12, alignItems: "flex-end", flexWrap: "wrap" }}>
                    <div style={{ flex: "1 1 240px", minWidth: 200 }}>
                      <label style={{ ...labelStyle, marginBottom: 6, display: "block" }}>City</label>
                      <input value={discoverCity} onChange={e => setDiscoverCity(e.target.value)} placeholder="e.g. Houston, Nashville, Raleigh..."
                        onKeyDown={e => e.key === "Enter" && discoverVenues()} style={{ ...inputStyle, fontSize: 15, padding: "12px 16px" }} />
                    </div>
                    <div style={{ flex: "1 1 300px", minWidth: 200 }}>
                      <label style={{ ...labelStyle, marginBottom: 6, display: "block" }}>Type</label>
                      <select value={discoverType} onChange={e => setDiscoverType(e.target.value)} style={{ ...selectStyle, fontSize: 14, padding: "12px 16px", width: "100%" }}>
                        <option value="upscale restaurants with private dining rooms">Upscale restaurants with private dining</option>
                        <option value="Michelin star restaurants with private dining rooms">Michelin Star restaurants</option>
                        <option value="steakhouses with private rooms for corporate events">Steakhouses with private rooms</option>
                        <option value="fine dining restaurants for executive dinners">Fine dining for executive dinners</option>
                        <option value="trendy restaurants with event spaces for networking">Trendy venues for networking events</option>
                        <option value="restaurants and venues with large private event spaces for 50+ guests">Large event spaces (50+)</option>
                      </select>
                    </div>
                    <button onClick={discoverVenues} disabled={isSearching || !discoverCity.trim()}
                      style={{ ...btnPrimary, padding: "12px 32px", fontSize: 14, opacity: isSearching || !discoverCity.trim() ? 0.6 : 1, whiteSpace: "nowrap", marginBottom: 1 }}>
                      {isSearching ? "Searching..." : "Search Venues"}
                    </button>
                  </div>
                ) : (
                  <div style={{ display: "flex", gap: 16, alignItems: "flex-start", flexWrap: "wrap" }}>
                    <div style={{ flex: "1 1 340px", minWidth: 280 }}>
                      <label style={{ ...labelStyle, marginBottom: 6, display: "block" }}>Cities (one per line or comma-separated)</label>
                      <textarea value={batchCities} onChange={e => setBatchCities(e.target.value)} rows={8}
                        placeholder={"Houston\nNashville\nCharlotte\nRaleigh\nSalt Lake City\nPhoenix\nDenver\nMinneapolis\nColumbus\nAtlanta\nDallas\nSeattle\nPortland\nBoston\nPhiladelphia"}
                        style={{ ...inputStyle, fontSize: 14, padding: "12px 16px", resize: "vertical", lineHeight: 1.6 }} />
                      <p style={{ fontSize: 12, color: "#A09889", margin: "6px 0 0" }}>
                        {batchCities.split(/[,\n]/).filter(c => c.trim()).length} cities entered (max 15)
                      </p>
                    </div>
                    <div style={{ flex: "1 1 280px", minWidth: 220 }}>
                      <label style={{ ...labelStyle, marginBottom: 6, display: "block" }}>Type</label>
                      <select value={discoverType} onChange={e => setDiscoverType(e.target.value)} style={{ ...selectStyle, fontSize: 14, padding: "12px 16px", width: "100%", marginBottom: 16 }}>
                        <option value="upscale restaurants with private dining rooms">Upscale restaurants with private dining</option>
                        <option value="Michelin star restaurants with private dining rooms">Michelin Star restaurants</option>
                        <option value="steakhouses with private rooms for corporate events">Steakhouses with private rooms</option>
                        <option value="fine dining restaurants for executive dinners">Fine dining for executive dinners</option>
                        <option value="trendy restaurants with event spaces for networking">Trendy venues for networking events</option>
                        <option value="restaurants and venues with large private event spaces for 50+ guests">Large event spaces (50+)</option>
                      </select>
                      <button onClick={discoverVenues} disabled={isSearching || !batchCities.trim()}
                        style={{ ...btnPrimary, padding: "14px 32px", fontSize: 14, width: "100%", opacity: isSearching || !batchCities.trim() ? 0.6 : 1 }}>
                        {isSearching ? `Searching ${batchProgress.current + 1} of ${batchProgress.total}...` : `Search ${batchCities.split(/[,\n]/).filter(c => c.trim()).length || 0} Cities`}
                      </button>
                      {isSearching && batchProgress.total > 1 && (
                        <div style={{ marginTop: 16 }}>
                          <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 6 }}>
                            <span style={{ fontSize: 12, color: "#5A5348", fontWeight: 600 }}>Progress</span>
                            <span style={{ fontSize: 12, color: "#8B8279" }}>{batchProgress.current} / {batchProgress.total}</span>
                          </div>
                          <div style={{ height: 8, background: "#E8E2D9", borderRadius: 4, overflow: "hidden" }}>
                            <div style={{ height: "100%", background: "linear-gradient(90deg, #8B7355, #C8956C)", borderRadius: 4, width: `${(batchProgress.current / batchProgress.total) * 100}%`, transition: "width 0.5s ease" }} />
                          </div>
                          <p style={{ fontSize: 12, color: "#8B7355", marginTop: 6, fontWeight: 500 }}>
                            Currently searching: {batchProgress.currentCity}
                          </p>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>

              {isSearching && discoveredVenues.length === 0 && (
                <div style={{ display: "flex", flexDirection: "column", gap: 12, padding: "24px 0" }}>
                  {[1, 2, 3, 4].map(i => (
                    <div key={i} style={{ height: 80, borderRadius: 12, background: "linear-gradient(90deg, #EDE8E0 25%, #F5F1EB 50%, #EDE8E0 75%)", backgroundSize: "200% 100%", animation: `shimmer 1.5s ease-in-out ${i * 0.2}s infinite` }} />
                  ))}
                  <p style={{ textAlign: "center", color: "#8B8279", fontSize: 14, marginTop: 8 }}>
                    Searching Yelp, TripAdvisor, and Google{batchProgress.currentCity ? ` for venues in ${batchProgress.currentCity}` : ""}...
                  </p>
                </div>
              )}

              {searchError && <div style={{ background: "#FFF5F5", border: "1px solid #E8C4C4", borderRadius: 10, padding: 20, textAlign: "center", color: "#8B4444", fontSize: 14 }}>{searchError}</div>}

              {discoveredVenues.length > 0 && (() => {
                const cities = [...new Set(discoveredVenues.map(v => v.city || "Unknown"))];
                const isMultiCity = cities.length > 1;
                return (
                <div>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }}>
                    <p style={{ margin: 0, fontSize: 15, color: "#3D3832", fontWeight: 600 }}>
                      Found {discoveredVenues.length} venues{isMultiCity ? ` across ${cities.length} cities` : ` in ${cities[0]}`}
                      {isSearching && " (still searching...)"}
                    </p>
                    {savedIds.size > 0 && <p style={{ margin: 0, fontSize: 13, color: "#2D8659", fontWeight: 600 }}>{savedIds.size} saved to tracker ‚úì</p>}
                  </div>
                  {isMultiCity ? cities.map(city => {
                    const cityVenues = discoveredVenues.filter(v => v.city === city);
                    return (
                      <div key={city} style={{ marginBottom: 32 }}>
                        <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 14 }}>
                          <h3 style={{ margin: 0, fontSize: 18, fontFamily: "'Playfair Display', serif", color: "#2C2622" }}>{city}</h3>
                          <span style={{ fontSize: 12, color: "#8B8279", background: "#EDE8E0", padding: "3px 10px", borderRadius: 12 }}>{cityVenues.length} venues</span>
                          <div style={{ flex: 1, height: 1, background: "#E8E2D9" }} />
                        </div>
                        <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(340px, 1fr))", gap: 16 }}>
                          {cityVenues.map(dv => <DiscoveredCard key={dv._id} dv={dv} />)}
                        </div>
                      </div>
                    );
                  }) : (
                    <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(340px, 1fr))", gap: 16 }}>
                      {discoveredVenues.map(dv => <DiscoveredCard key={dv._id} dv={dv} />)}
                    </div>
                  )}
                </div>
                );
              })()}

              {!isSearching && !searchError && discoveredVenues.length === 0 && (
                <div style={{ textAlign: "center", padding: "60px 20px", color: "#A09889" }}>
                  <p style={{ fontSize: 56, margin: "0 0 12px" }}>üç∑</p>
                  <p style={{ fontSize: 18, fontFamily: "'Playfair Display', serif", color: "#5A5348" }}>Search any city to discover venues</p>
                  <p style={{ fontSize: 13, maxWidth: 420, margin: "8px auto 0", lineHeight: 1.6 }}>Search one city at a time or switch to Batch Search to search up to 15 cities at once ‚Äî perfect for quarterly planning.</p>
                </div>
              )}
            </div>
          )}

          {/* ‚ïê‚ïê‚ïê TRACKER ‚ïê‚ïê‚ïê */}
          {mode === "tracker" && (
            <React.Fragment>
              <div style={{ padding: "20px 40px", background: "#FDFCFA", borderBottom: "1px solid #E8E2D9" }}>
                <div style={{ display: "flex", gap: 12, alignItems: "center", flexWrap: "wrap" }}>
                  <div style={{ position: "relative", flex: "0 0 240px" }}>
                    <input value={search} onChange={e => setSearch(e.target.value)} placeholder="Search venues or cities..." style={{ ...inputStyle, paddingLeft: 36 }} />
                    <span style={{ position: "absolute", left: 12, top: "50%", transform: "translateY(-50%)", color: "#A09889", fontSize: 15 }}>‚åï</span>
                  </div>
                  <select value={filterRegion} onChange={e => setFilterRegion(e.target.value)} style={selectStyle}>
                    <option value="All">All Regions</option>
                    {Object.keys(REGIONS).map(r => <option key={r}>{r}</option>)}
                  </select>
                  <select value={filterSize} onChange={e => setFilterSize(e.target.value)} style={selectStyle}>
                    <option value="All">All Sizes</option>
                    {EVENT_SIZES.map(s => <option key={s}>{s}</option>)}
                  </select>
                  <select value={filterStatus} onChange={e => setFilterStatus(e.target.value)} style={selectStyle}>
                    <option value="All">All Statuses</option>
                    {STATUSES.map(s => <option key={s}>{s}</option>)}
                  </select>
                  <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                    <span style={{ fontSize: 12, color: "#8B8279" }}>Budget ‚â§</span>
                    <input type="range" min={50} max={300} value={budgetMax} onChange={e => setBudgetMax(+e.target.value)} style={{ width: 100 }} />
                    <span style={{ fontSize: 13, fontWeight: 600, color: "#2C2622", minWidth: 40 }}>${budgetMax}</span>
                  </div>
                </div>
                <div style={{ display: "flex", gap: 20, alignItems: "center", marginTop: 12 }}>
                  <Toggle checked={filterPrivate} onChange={setFilterPrivate} label="Private Room" />
                  <Toggle checked={filterAV} onChange={setFilterAV} label="AV Ready" />
                  <Toggle checked={filterDietary} onChange={setFilterDietary} label="Dietary Flex" />
                  <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                    <span style={{ fontSize: 12, color: "#8B8279" }}>Min Exclusivity</span>
                    <StarRating rating={filterExclusivity} interactive onRate={r => setFilterExclusivity(r === filterExclusivity ? 0 : r)} size={16} />
                  </div>
                  <div style={{ marginLeft: "auto", display: "flex", gap: 8, alignItems: "center" }}>
                    <select value={sortBy} onChange={e => setSortBy(e.target.value)} style={{ ...selectStyle, minWidth: 100 }}>
                      <option value="name">Sort: Name</option>
                      <option value="price">Sort: Price</option>
                      <option value="exclusivity">Sort: Exclusivity</option>
                      <option value="rating">Sort: Rating</option>
                      <option value="city">Sort: City</option>
                    </select>
                    <div style={{ display: "flex", border: "1.5px solid #D5CEC4", borderRadius: 8, overflow: "hidden" }}>
                      {["grid", "table"].map(v => (
                        <button key={v} onClick={() => setView(v)}
                          style={{ padding: "6px 14px", border: "none", background: view === v ? "#8B7355" : "#FDFCFA", color: view === v ? "#fff" : "#8B8279", fontSize: 12, cursor: "pointer", fontWeight: 600 }}>
                          {v === "grid" ? "‚óª Grid" : "‚ò∞ Table"}
                        </button>
                      ))}
                    </div>
                    <button onClick={() => setShowAddForm(true)} style={btnPrimary}>+ Add Venue</button>
                  </div>
                </div>
              </div>
              <div style={{ padding: "28px 40px", marginRight: selectedVenue ? 520 : 0, transition: "margin-right 0.25s ease" }}>
                <p style={{ margin: "0 0 16px", fontSize: 13, color: "#8B8279" }}>Showing {filtered.length} of {venues.length} venues</p>
                {view === "grid" ? (
                  <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(320px, 1fr))", gap: 16 }}>
                    {filtered.map(v => <VenueCard key={v.id} venue={v} />)}
                  </div>
                ) : (
                  <div style={{ background: "#fff", borderRadius: 12, border: "1.5px solid #E8E2D9", overflow: "hidden" }}>
                    <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 13 }}>
                      <thead><tr style={{ borderBottom: "2px solid #E8E2D9" }}>
                        {["Venue", "City", "Region", "$/Head", "Exclusivity", "Status", "Features", "Rating"].map(h => (
                          <th key={h} style={{ padding: "12px 16px", textAlign: "left", fontSize: 10, textTransform: "uppercase", letterSpacing: "0.1em", color: "#A09889", fontWeight: 600, background: "#FDFCFA" }}>{h}</th>
                        ))}
                      </tr></thead>
                      <tbody>{filtered.map(v => <VenueRow key={v.id} venue={v} />)}</tbody>
                    </table>
                  </div>
                )}
                {filtered.length === 0 && (
                  <div style={{ textAlign: "center", padding: "60px 20px", color: "#A09889" }}>
                    <p style={{ fontSize: 48, margin: "0 0 12px" }}>üçΩ</p>
                    <p style={{ fontSize: 16, fontFamily: "'Playfair Display', serif" }}>No venues match your filters</p>
                    <p style={{ fontSize: 13 }}>Try adjusting your search or filters</p>
                  </div>
                )}
              </div>
            </React.Fragment>
          )}

          {selectedVenue && <DetailPanel venue={selectedVenue} />}
          {showAddForm && <AddForm />}
          {showSettings && <SettingsModal />}
        </div>
      );
    }

    ReactDOM.render(<VenueTracker />, document.getElementById("root"));
  </script>
</body>
</html>
